{{ template "header.html" . }}

<h1 class="dex-title">{{ .Tr.login_title }}</h1>

<form method="post" action="{{ .PostURL }}">
    {{ if .RequireTOTP }}
    <input type="hidden" name="login" value="{{ .Username }}" />
    <input type="hidden" name="password" value="{{ .Password }}" />
    <input type="hidden" name="receipt" value="{{ .Receipt }}" />
    {{ if .ShowDomain }}<input
        type="hidden"
        name="domain"
        value="{{ .Domain }}"
    />{{ end }}

    <div class="dex-input-group">
        <label for="totp" class="dex-label">{{ .Tr.totp_label }}</label>
        <input
            tabindex="1"
            required
            id="totp"
            name="totp"
            type="text"
            class="dex-input"
            autofocus
            autocomplete="off"
        />
    </div>

    {{ if .Invalid }}
    <div class="dex-error">{{ .Tr.totp_invalid }}</div>
    {{ end }}

    <button tabindex="2" id="submit-login" type="submit" class="dex-btn">
        {{ .Tr.totp_verify_button }}
    </button>

    {{ else }}
    <!-- Normal Login -->

    <div class="dex-input-group">
        <label for="login" class="dex-label">{{ .Tr.username_label }}</label>
        <input
            tabindex="1"
            required
            id="login"
            name="login"
            type="text"
            class="dex-input"
            placeholder="{{ .UsernamePrompt }}"
            {{
            if
            .Username
            }}
            value="{{ .Username }}"
            {{
            else
            }}
            autofocus
            {{
            end
            }}
        />
    </div>

    <div class="dex-input-group">
        <label for="password" class="dex-label">{{ .Tr.password_label }}</label>
        <div style="position: relative;">
            <input
                tabindex="2"
                required
                id="password"
                name="password"
                type="password"
                class="dex-input"
                style="padding-right: 40px;"
                placeholder=""
                {{
                if
                .Invalid
                }}
                autofocus
                {{
                end
                }}
            />
            <button type="button" id="toggle-password" tabindex="-1" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; color: var(--text-color, #666); outline: none;" title="Mostrar ContraseÃ±a">
                <svg id="eye-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                </svg>
            </button>
        </div>
    </div>

    {{ if .ShowDomain }}
    <div class="dex-input-group">
        <label for="domain" class="dex-label">{{ .Tr.domain_label }}</label>
        <input
            tabindex="3"
            id="domain"
            name="domain"
            type="text"
            class="dex-input"
            placeholder="{{ .Tr.domain_label }}"
            {{
            if
            .Domain
            }}
            value="{{ .Domain }}"
            {{
            end
            }}
        />
    </div>
    {{ end }}

    {{ if .Invalid }}
    <div class="dex-error">{{ .Tr.invalid_credentials }}</div>
    {{ end }}

    <button tabindex="4" id="submit-login" type="submit" class="dex-btn">
        {{ .Tr.login_button }}
    </button>
    {{ end }}
</form>

{{ if .BackLink }}
<a class="dex-btn dex-btn-secondary" href="{{ .BackLink }}"
    >{{ .Tr.back_button }}</a
>
{{ end }}

<script type="text/javascript">
    document.querySelector("form").onsubmit = function (e) {
        var el = document.querySelector("#submit-login");
        el.setAttribute("disabled", "disabled");
        el.innerHTML = "{{ .Tr.signing_in }}";
    };

    var toggleBtn = document.querySelector("#toggle-password");
    var passInput = document.querySelector("#password");
    if (toggleBtn && passInput) {
        toggleBtn.addEventListener("click", function (e) {
            e.preventDefault();
            var type = passInput.getAttribute("type") === "password" ? "text" : "password";
            passInput.setAttribute("type", type);
            var svg = toggleBtn.querySelector("svg");
            if (type === "text") {
                svg.innerHTML = '<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line>';
            } else {
                svg.innerHTML = '<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle>';
            }
        });
    }
</script>

{{ template "footer.html" . }}
